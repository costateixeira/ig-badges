#env:
#  gh_owner: ${GITHUB_REPOSITORY_OWNER}
concurrency: ci-${{ github.ref }}

on:
  push:
  workflow_call:
    inputs:
      token:
        required: true
        type: string
      repo:
        required: true
        type: string
      branch:
        required: true
        type: string


name: UpdateReadme
jobs:
  web-deploy:
    name: Ubuntu VM
    runs-on: ubuntu-latest
    steps:
    - name: Getting latest Code
      uses: actions/checkout@v2.3.2
      
    - name: wget
      uses: wei/wget@v1
      with:
        args: -O README_SRC.md https://raw.githubusercontent.com/costateixeira/ig-badges/main/badges.md    
      
    - name: Replace text in badges
      run: |
        sed -i -e "s|__GH_OWNER__|${GITHUB_REPOSITORY_OWNER}|g" badges.md
        sed -i -e "s|__GH_BRANCH__|${GITHUB_REF##*/}|g"         badges.md
        sed -i -e "s|__GH_REPO__|${GITHUB_REPOSITORY##*/}|g"    badges.md

    - name: replace include with content of badges
      run: |
        FILE2=$(<README.md)
        FILE1=$(<badges.md)
        echo "${FILE2//{% include badges.md %}/$FILE1}" > README.md

    - run: ls
    
    - run: |
        rm README_SRC.md
        rm badges.md
        
    - name: stage changed files
      run: git add .


    - name: Deploy candidate
      uses: JamesIves/github-pages-deploy-action@4.1.4
      with:
#        branch: ${GITHUB_REF##*/} # The branch the action should deploy to.
        branch: main # The branch the action should deploy to.
        folder: . # The folder the action should deploy.
        commit-message: Deploy branch
        target-folder: .
        clean: false 
